<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Login - Cyber Report RMS</title>
  <link href="../assets/css/style.css" rel="stylesheet">
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="container d-flex align-center justify-between">
      <span class="nav-brand">Cyber Incident Reporting RMS</span>
      <!-- No links for login page -->
    </div>
  </nav>

  <!-- Auth Container -->
  <div class="auth-container">
    <div class="card auth-card">
      <h2 class="text-center mb-4">Sign In</h2>
      <p class="text-center mb-4" style="color: var(--text-muted)">Welcome back to RMS</p>

      <div id="alert" class="alert d-none" role="alert"></div>

      <form id="loginForm">
        <div class="form-group">
          <label class="form-label" for="email">Email Address</label>
          <input type="email" id="email" class="form-control" placeholder="name@example.com" required>
        </div>

        <div class="form-group">
          <label class="form-label" for="password">Password</label>
          <input type="password" id="password" class="form-control" placeholder="••••••••" required>
        </div>

        <button type="submit" class="btn btn-primary w-100">Sign In</button>
      </form>

      <p class="mt-4 text-center text-muted" style="font-size: 0.9rem">
        Don't have an account? <a href="register.html">Register here</a>
      </p>
    </div>
  </div>

  <script>
    const API_BASE = '../backend';
    const alertBox = document.getElementById('alert');

    document.getElementById('loginForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const payload = {
        email: document.getElementById('email').value.trim(),
        password: document.getElementById('password').value
      };

      fetch(`${API_BASE}/login.php`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify(payload)
      })
        .then(r => r.json())
        .then(d => {
          alertBox.classList.remove('d-none', 'alert-danger', 'alert-success');

          if (d.success) {
            alertBox.classList.add('alert-success');
            alertBox.textContent = d.message || 'Login successful';

            setTimeout(() => {
              if (d.data.role === 'admin') {
                window.location.href = 'admin.html';
              } else {
                window.location.href = 'reports.html';
              }
            }, 600);
          } else {
            alertBox.classList.add('alert-danger');
            alertBox.textContent = d.message || 'Login failed';
          }
        })
        .catch(() => {
          alertBox.classList.remove('d-none');
          alertBox.classList.add('alert-danger');
          alertBox.textContent = 'Unable to reach server';
        });
    });
  </script>
</body>

</html>